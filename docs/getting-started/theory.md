`PhlyGreen` (flʌɪɡriːn) is a Python object-oriented code for conducting preliminary design analysis on hybrid/electric aircraft. The `PhlyGreen` architecture facilitates the definition of Multidisciplinary Design Optimization (MDO) problems and the implementation of several discipline blocks into the optimization loop. 

## Aircraft preliminary design basics

The analysis starts from the point model energy balance equation obtained along the aircraft velocity direction:

$$
\frac{P_p}{W_{TO}} = g \,\frac{1}{W_{TO}/S}\, q\, V\, C_D + \beta\, P_s,
$$

where $g$ is the gravity acceleration, $q=1/2 \rho V^2$ is the dynamic pressure, $\beta=W(t)/W_{TO}$ is the instantaneous-to-take-off mass ratio, $C_D$ is the drag coefficient, and $P_s$ the specific excess power. The parameters $q$,$C_D$,$\beta$,$P_s$ depend on the instantaneous flight condition, i.e., velocity $V$, altitude $h$ and attitude. More specifically, $C_D(C_L)$ requires an aerodynamic polar model. The energy balance equation can be specified for each of the performance constraints denoted by the Top-level aircraft requirements (TLARs), designating a feasible space in terms of power-to-weight ratio $P_p/W_{TO}$ and wing loading $W_{TO}/S$. 

The powertrain model enables the generalization of the propulsive architecture. In fact, by considering the power flow pathways within a generic powertrain, a system of equations can be formulated as $\sum P_{out} = \sum \eta_i P_{in,i}$. If a hybrid parallel powertrain is considered, as done in the following, the linear system of equations is written as:

$$
\begin{bmatrix}
-\eta_{GT} & 1 & 0 & 0 & 0 & 0 & 0 \\
0 & -\eta_{GB} & -\eta_{GB} & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0  & 1 & -\eta_{PM} & 0 \\
0 & 0 & 1 & 0 & -\eta_{EM} & 0 & 0 \\
0 & 0 & 0 & -\eta_P & 0 & 0 & 1 \\
\varphi & 0 & 0 & 0 & 0 & \varphi - 1 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 1 
\end{bmatrix}
\begin{bmatrix}
    P_f \\
    P_{gt} \\
    P_{gb} \\
    P_{sh} \\
    P_{e} \\
    P_{bat} \\
    P_p
\end{bmatrix}
=
\begin{bmatrix}
    0 \\
    0 \\ 
    0 \\
    0 \\ 
    0 \\
    0 \\
    P_p
\end{bmatrix}
$$

where 

$$
\varphi = \frac{P_{bat}}{P_{bat} + P_f} \in [0, 1]
$$

is the instantaneous supplied power ratio, representing the portion of electrical power used by the engine on the total power reserve. In the system above, $\eta_{GT}$ is the gas-turbine turbo-shaft engine efficiency, $\eta_{GB}$ is the gearbox transmission efficiency, $\eta_{EM}$ is the electric motor efficiency, $\eta_{PM}$ is the power electronics efficiency, $\eta_{P}$ is the propeller efficiency, while $P_p$ is the propulsive power (i.e. the power transmitted by the propeller to the airflow), $P_{sh}$ is the shaft power (i.e. the power transmitted by the shaft to the propeller), $P_{gb}$ is the gearbox transmitted power, $P_{gt}$ is the power generated by the GT engine, $P_{e}$ is the electric power generated by the electric motor, $P_{bat}$ is the power required at the battery, and $P_f$ is the power extracted from the fuel. To give a simple example, in a traditional configuration, the following chain holds:

$$
P_f = \frac{1}{\eta_{GT}}\cdot \frac{1}{\eta_{sh}} \cdot \frac{1}{\eta_{GB}} \cdot \frac{1}{\eta_{P}} \cdot P_p.
$$

In other words, the efficiency chain amplifies the required aircraft power (due to drag) to a much higher fuel power. 

By solving the linear system above, the power-to-weight ratios referred to both fuel (P_f/W_{TO}) and battery (P_{bat}/W_{TO}) can be determined. These values can then be integrated in time along the mission profile to ascertain the cumulative energy contributions from the electric and fuel sources:

$$
E_i = \int_{t_s}^{t_e} \frac{P_i}{W_{TO}} \left( \varphi(t), \beta(t), h(t), V(t),\frac{W_{TO}}{S} \right) \, W_{TO} \, dt \, ,
$$

where the index $i$ is representative of the fuel and battery sources. Note that the supplied power ratio $\varphi$ is an instantaneous quantity as well, which can be varied to define the most adequate hybridization strategy. 

The energy produced by burning fuel can be easily converted into the fuel weight $W_F$ by using the fuel heating value, while the battery weight will be computed following two different methodologies: a) a low-fidelity formulation based on the most demanding scenario in terms of power and energy capacity along the mission profile and b) a higher-fidelity which accounts for the State-of-Charge (SoC) effects on a cell-level and computes the number of required serial and parallel cell numbers. The latter formulation is further discussed in Battery Module user guide.

The total weight breakdown is completed by the operative empty weight (OEW) $W_{OE}$ and payload $W_{PL}$:

$$
W_{TO} = W_{F} + W_{bat} + W_{PL} + W_{OE} \; \; ,
$$

where 

$$
W_{OE} = W_{ST} + W_{PT} + W_{crew} \; \; .
$$

The structural weight $W_{ST}$ can be estimated again following two approaches: a) a low-fidelity quick estimate based on empirical correlations between $W_{ST}$ and $W_{TO}$ of existing aircraft (class I); b) the more detailed estimations proposed in the FLOPS software, which consider the structural mass as the sum of the masses of several aircraft components (class II). The powertrain weight is estimated using the specific power of the components of the chosen architecture, considering the peak power requirement across the mission, take-off, and the TLARs. Given that the value of $W_{TO}$ is needed in the intgeral equation above, the weight estimation necessitates an iterative procedure, such as Brent's method. The mission profile is modeled as a continuous function to integrate using the Backward differentiation formula (BDF) solver, an adaptive step method that does not rely on a priori time discretization of the mission.

## References

- Roskam, J., Airplane Design, DARcorporation, 1985.
- Torenbeek, E., Synthesis of Subsonic Airplane Design: an Introduction to the Preliminary Design of Subsonic General Aviation and Transport Aircraft, with Emphasis on Layout, Aerodynamic Design, Propulsion and Performance, Springer Science & Business Media, 2013
- Mattingly, J. D., Aircraft Engine Design, AIAA, 2002.
- Isikveren, A. T., Kaiser, S., Pornet, C., and Vratny, P. C., “Pre-design Strategies and Sizing Techniques for Dual-energy Aircraft,” Aircraft Engineering and Aerospace Technology: An International Journal, Vol. 86, No. 6, 2014, pp. 525–542.
- Pornet, C., Gologan, C., Vratny, P. C., Seitz, A., Schmitz, O., Isikveren, A. T., and Hornung, M., “Methodology for Sizing and Performance Assessment of Hybrid Energy Aircraft,” Journal of Aircraft, Vol. 52, No. 1, 2015, pp. 341–352.
- Zamboni, J., Vos, R., Emeneth, M., and Schneegans, A., “A Method for the Conceptual Design of Hybrid Electric Aircraft,” AIAA Scitech 2019 Forum, 2019, p. 1587
- Orefice, F., Della Vecchia, P., Ciliberti, D., and Nicolosi, F., “Aircraft Conceptual Design Including Powertrain System Architecture and Distributed Propulsion,” 2019 AIAA/IEEE Electric Aircraft Technologies Symposium (EATS), IEEE, 2019, pp.1–20
- de Vries, R., Brown, M. T., and Vos, R., “A Preliminary Sizing Method for Hybrid-Electric Aircraft Including Aero-Propulsive Interaction Effects,” 2018 Aviation Technology, Integration, and Operations Conference, 2018, p. 4228.
- De Vries, R., Brown, M., and Vos, R., “Preliminary Sizing Method for Hybrid-Electric Distributed-Propulsion Aircraft,” Journal of Aircraft, Vol. 56, No. 6, 2019, pp. 2172–2188
- Finger, D. F., Braun, C., and Bil, C., “Impact of Engine Failure Constraints on the Initial Sizing of Hybrid-Electric GA Aircraft,” AIAA Scitech 2019 Forum, 2019, p. 1812
- Proesmans, P.-J., and Vos, R., “Airplane Design Optimization for Minimal Global Warming Impact,” Journal of Aircraft, Vol. 59, No. 5, 2022, pp. 1363–1381
- Filippone, A., and Bojdo, N., “Statistical Model for Gas Turbine Engines Exhaust Emissions,” Transportation Research Part D: Transport and Environment, Vol. 59, 2018, pp. 451–463
